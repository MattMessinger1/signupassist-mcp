{
  "openapi": "3.1.0",
  "info": {
    "title": "SignupAssist MCP API",
    "version": "2.2.0",
    "description": "AI-powered activity registration assistant for finding and booking children's activities (robotics, STEM, swim lessons, camps, sports, art, music) across the United States.\n\n**For ChatGPT:** Use the `/orchestrator/chat` endpoint for all queries. Send natural language like 'find robotics classes in Madison WI for my 8 year old' and the system handles location matching, activity detection, age filtering, and provider discovery automatically.\n\n**Supported Activities:** robotics, STEM, coding, swim lessons, summer camps, sports, art, music, dance, martial arts, tutoring, and more.\n\n**Geographic Coverage:** US-based providers, primarily in the Midwest (Wisconsin, Illinois, Minnesota) with expanding coverage.",
    "contact": {
      "email": "matt@shipworx.ai"
    },
    "x-openai-isConversational": true
  },
  "servers": [
    {
      "url": "https://signupassist-mcp-production.up.railway.app",
      "description": "Production MCP Server"
    }
  ],
  "paths": {
    "/orchestrator/chat": {
      "post": {
        "summary": "Chat with SignupAssist (RECOMMENDED)",
        "description": "Send natural language messages to find and register for activities. Understands locations, ages, activity types. Maintains conversation context across messages.",
        "operationId": "chat",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["message", "sessionId"],
                "properties": {
                  "message": {
                    "type": "string",
                    "description": "Natural language message from the user (e.g., 'find robotics programs in Madison', 'show me swim lessons for kids')"
                  },
                  "sessionId": {
                    "type": "string",
                    "description": "Unique session ID for conversation continuity. Use the same ID across messages in a conversation."
                  },
                  "action": {
                    "type": "string",
                    "enum": [
                      "select_program",
                      "select_child",
                      "answer_questions",
                      "confirm_booking",
                      "cancel_booking",
                      "show_more_programs",
                      "change_filters",
                      "back",
                      "start_over"
                    ],
                    "description": "Action to execute when responding to a card button click. Usually populated from the action field of button responses."
                  },
                  "payload": {
                    "type": "object",
                    "description": "Data payload for the action (e.g., program_ref for select_program, answers for answer_questions)",
                    "additionalProperties": true
                  },
                  "userTimezone": {
                    "type": "string",
                    "description": "User's IANA timezone (e.g., 'America/Chicago'). Used for displaying times correctly.",
                    "default": "America/Chicago"
                  }
                }
              },
              "examples": {
                "find_robotics_madison": {
                  "summary": "Find robotics programs in Madison",
                  "value": {
                    "message": "Find robotics classes in Madison WI",
                    "sessionId": "chatgpt-session-123"
                  }
                },
                "find_swim_lessons_with_age": {
                  "summary": "Find swim lessons for a specific age",
                  "value": {
                    "message": "Show me swim lessons for my 8 year old",
                    "sessionId": "chatgpt-session-123",
                    "userTimezone": "America/Chicago"
                  }
                },
                "find_by_org_name": {
                  "summary": "Find programs at a specific organization",
                  "value": {
                    "message": "What programs does AIM Design offer?",
                    "sessionId": "chatgpt-session-123"
                  }
                },
                "select_program_action": {
                  "summary": "Select a program from results",
                  "value": {
                    "message": "",
                    "sessionId": "chatgpt-session-123",
                    "action": "select_program",
                    "payload": {
                      "program_ref": "robotics-101",
                      "org_ref": "aim-design"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Chat response with message and optional UI cards",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChatResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - OAuth token required for protected actions (booking, payment)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "requiresAuth": { "type": "boolean" },
                    "authUrl": { "type": "string" }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "details": { "type": "string" }
                  }
                }
              }
            }
          }
        },
        "security": [
          {},
          { "oauth2": ["openid", "profile", "email"] }
        ]
      }
    },
    "/tools/call": {
      "post": {
        "summary": "Execute MCP tool directly (advanced)",
        "description": "Execute a specific MCP tool by name. **Use /orchestrator/chat instead** for natural language queries - this endpoint requires knowing the exact tool name and org_ref. Only use this for advanced integrations or debugging.",
        "operationId": "callTool",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["tool", "args"],
                "properties": {
                  "tool": {
                    "type": "string",
                    "enum": [
                      "bookeo.find_programs",
                      "bookeo.discover_required_fields",
                      "bookeo.create_hold",
                      "bookeo.confirm_booking",
                      "bookeo.cancel_booking",
                      "program_feed.get"
                    ],
                    "description": "Name of the tool to execute"
                  },
                  "args": {
                    "type": "object",
                    "description": "Tool-specific arguments",
                    "additionalProperties": true
                  },
                  "mandate_id": {
                    "type": "string",
                    "description": "Optional mandate ID for audit trail",
                    "format": "uuid"
                  },
                  "plan_execution_id": {
                    "type": "string",
                    "description": "Optional plan execution ID for tracking",
                    "format": "uuid"
                  }
                }
              },
              "examples": {
                "bookeo_find_programs": {
                  "summary": "Find programs at a Bookeo-powered organization",
                  "value": {
                    "tool": "bookeo.find_programs",
                    "args": {
                      "org_ref": "aim-design",
                      "category": "all"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful tool execution",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProviderResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "details": { "type": "string" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - OAuth token invalid or missing",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Tool not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "available_tools": {
                      "type": "array",
                      "items": { "type": "string" }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "details": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ChatResponse": {
        "type": "object",
        "description": "Response from the chat orchestrator containing the assistant message and optional UI elements",
        "required": ["message"],
        "properties": {
          "message": {
            "type": "string",
            "description": "The assistant's response message to display to the user"
          },
          "cards": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/UICard" },
            "description": "UI cards for programs, forms, confirmations, or other structured content"
          },
          "cta": {
            "type": "object",
            "description": "Call-to-action buttons for the response",
            "properties": {
              "buttons": {
                "type": "array",
                "items": { "$ref": "#/components/schemas/Button" }
              }
            }
          },
          "actions": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/Button" },
            "description": "Available actions the user can take (legacy format, prefer cta.buttons)"
          },
          "contextUpdates": {
            "type": "object",
            "description": "State changes from this interaction (for debugging/tracking)",
            "properties": {
              "currentStep": { "type": "string" },
              "selectedProgram": { "type": "string" },
              "selectedChild": { "type": "string" },
              "provider": { "type": "string" }
            },
            "additionalProperties": true
          },
          "suggestedQueries": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Suggested follow-up queries the user might want to ask",
            "examples": [
              ["Show me the schedule", "What ages is this for?", "How much does it cost?"]
            ]
          },
          "error": {
            "type": "object",
            "description": "Error information if the request failed",
            "properties": {
              "code": { "type": "string" },
              "message": { "type": "string" },
              "recoveryHint": { "type": "string" }
            }
          },
          "session_context": {
            "type": "object",
            "description": "Current session state (for debugging)",
            "additionalProperties": true
          }
        }
      },
      "Button": {
        "type": "object",
        "description": "Interactive button for user actions",
        "required": ["label", "action"],
        "properties": {
          "label": {
            "type": "string",
            "description": "Button text displayed to user"
          },
          "action": {
            "type": "string",
            "description": "Action identifier to send back when clicked"
          },
          "payload": {
            "type": "object",
            "description": "Data to include when this action is triggered",
            "additionalProperties": true
          },
          "variant": {
            "type": "string",
            "enum": ["accent", "outline", "destructive"],
            "default": "accent"
          },
          "requiresAuth": {
            "type": "boolean",
            "description": "Whether this action requires OAuth authentication",
            "default": false
          }
        }
      },
      "ToolMetadata": {
        "type": "object",
        "description": "Metadata hints for AI tone and UX guidance",
        "properties": {
          "tone_hints": {
            "type": "string",
            "description": "Guidance for AI tone (e.g., 'Emphasize age ranges and schedule flexibility')"
          },
          "security_note": {
            "type": "string",
            "description": "Security reminder to display"
          },
          "next_actions": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Suggested next actions for the user"
          },
          "confidence": {
            "type": "string",
            "enum": ["high", "medium", "low"],
            "description": "Confidence level of the response"
          }
        }
      },
      "UICard": {
        "type": "object",
        "description": "UI card specification for consistent rendering of programs, forms, and confirmations",
        "required": ["title"],
        "properties": {
          "type": {
            "type": "string",
            "enum": ["program", "form", "confirmation", "error", "info"],
            "description": "Card type for rendering hints"
          },
          "title": { "type": "string" },
          "subtitle": { "type": "string" },
          "description": { "type": "string" },
          "imageUrl": { "type": "string", "format": "uri" },
          "metadata": {
            "type": "object",
            "description": "Structured data (price, dates, age range, etc.)",
            "properties": {
              "price": { "type": "string" },
              "ageRange": { "type": "string" },
              "dates": { "type": "string" },
              "location": { "type": "string" },
              "spotsAvailable": { "type": "integer" }
            },
            "additionalProperties": true
          },
          "buttons": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/Button" }
          }
        }
      },
      "ParentFriendlyError": {
        "type": "object",
        "description": "Parent-friendly error structure",
        "required": ["display", "recovery", "severity"],
        "properties": {
          "display": {
            "type": "string",
            "description": "What parent sees"
          },
          "recovery": {
            "type": "string",
            "description": "Clear next step"
          },
          "severity": {
            "type": "string",
            "enum": ["low", "medium", "high"]
          },
          "code": {
            "type": "string",
            "description": "Internal error code"
          }
        }
      },
      "ProviderResponse": {
        "type": "object",
        "description": "Standard response format for all provider tools",
        "required": ["success"],
        "properties": {
          "success": { "type": "boolean" },
          "data": {
            "type": "object",
            "additionalProperties": true
          },
          "meta": { "$ref": "#/components/schemas/ToolMetadata" },
          "ui": {
            "type": "object",
            "properties": {
              "cards": {
                "type": "array",
                "items": { "$ref": "#/components/schemas/UICard" }
              },
              "message": { "type": "string" }
            }
          },
          "error": {
            "oneOf": [
              { "$ref": "#/components/schemas/ParentFriendlyError" },
              { "type": "string" }
            ]
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "bookeo.find_programs_input": {
        "type": "object",
        "properties": {
          "org_ref": {
            "type": "string",
            "description": "Organization reference (e.g., 'aim-design' for Madison robotics/STEM)"
          },
          "category": {
            "type": "string",
            "description": "Optional category filter (e.g., 'stem', 'all')"
          }
        },
        "required": ["org_ref"],
        "additionalProperties": false
      },
      "bookeo.discover_required_fields_input": {
        "type": "object",
        "properties": {
          "program_ref": {
            "type": "string",
            "description": "Program reference ID from find_programs"
          },
          "org_ref": {
            "type": "string",
            "description": "Organization reference"
          }
        },
        "required": ["program_ref", "org_ref"],
        "additionalProperties": false
      },
      "bookeo.create_hold_input": {
        "type": "object",
        "properties": {
          "eventId": {
            "type": "string",
            "description": "Bookeo event ID"
          },
          "productId": {
            "type": "string",
            "description": "Bookeo product ID"
          },
          "firstName": {
            "type": "string",
            "description": "Customer first name"
          },
          "lastName": {
            "type": "string",
            "description": "Customer last name"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Customer email"
          },
          "phone": {
            "type": "string",
            "description": "Customer phone (optional)"
          },
          "adults": {
            "type": "integer",
            "description": "Number of adult participants"
          },
          "children": {
            "type": "integer",
            "description": "Number of child participants"
          },
          "org_ref": {
            "type": "string",
            "description": "Organization reference"
          }
        },
        "required": ["eventId", "productId", "firstName", "lastName", "email", "adults", "children", "org_ref"],
        "additionalProperties": false
      },
      "bookeo.confirm_booking_input": {
        "type": "object",
        "properties": {
          "holdId": {
            "type": "string",
            "description": "Hold ID from create_hold"
          },
          "org_ref": {
            "type": "string",
            "description": "Organization reference"
          }
        },
        "required": ["holdId", "org_ref"],
        "additionalProperties": false
      },
      "bookeo.cancel_booking_input": {
        "type": "object",
        "properties": {
          "bookingNumber": {
            "type": "string",
            "description": "Booking number to cancel"
          },
          "org_ref": {
            "type": "string",
            "description": "Organization reference"
          }
        },
        "required": ["bookingNumber", "org_ref"],
        "additionalProperties": false
      },
      "program_feed.get_input": {
        "type": "object",
        "properties": {
          "org_ref": {
            "type": "string",
            "description": "Organization reference"
          },
          "category": {
            "type": "string",
            "description": "Category filter"
          },
          "age_hint": {
            "type": "integer",
            "description": "Optional age for filtering age-appropriate programs"
          }
        },
        "required": ["org_ref"],
        "additionalProperties": false
      }
    },
    "securitySchemes": {
      "oauth2": {
        "type": "oauth2",
        "description": "OAuth 2.0 authentication for protected actions (booking confirmations, payments). Public queries (finding programs) do not require authentication.",
        "flows": {
          "authorizationCode": {
            "authorizationUrl": "https://signupassist-mcp-production.up.railway.app/oauth/authorize",
            "tokenUrl": "https://signupassist-mcp-production.up.railway.app/oauth/token",
            "scopes": {
              "openid": "OpenID Connect",
              "profile": "User profile",
              "email": "User email"
            }
          }
        }
      }
    }
  },
  "security": [
    { "oauth2": ["openid", "profile", "email"] }
  ]
}
