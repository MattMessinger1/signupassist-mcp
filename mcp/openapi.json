{
  "openapi": "3.1.0",
  "info": {
    "title": "SignupAssist",
    "version": "2.4.0",
    "description": "**SignupAssist helps parents find and register their children for activities.** Just tell me what you're looking for!\n\n**How to use:** Simply describe what you need - like 'find robotics classes for my 8 year old in Madison WI' or 'sign up for swim lessons'. I understand natural language and will guide you through the entire registration process.\n\n**What I can help with:** robotics, STEM, coding, swim lessons, summer camps, sports, art, music, dance, martial arts, and more.\n\n**Coverage:** US-based providers, primarily in the Midwest with expanding coverage.\n\n---\n\n## Trust & Security\n\n**Nothing is booked or charged until you press Confirm.** Every step is recorded in your Audit Trail for full transparency.\n\n- **Payment Security:** Payments are handled by Stripe. SignupAssist never sees your full card number.\n- **Refunds:** Program fee refunds are handled by the provider. SignupAssist success fee refunds are handled by SignupAssist.\n- **Responsible Delegate:** All actions are audited with timestamps and mandate tracking for compliance.\n\n---\n\n## Payment Flow\n\n1. Browse & select a program\n2. Fill out the registration form\n3. Set up payment method (Stripe)\n4. Review & authorize payment\n5. Confirm booking\n\n---\n\n## Action Categories\n\n**Discovery:** search_programs, browse_all_programs, clear_activity_filter, show_out_of_area_programs, confirm_provider, deny_provider\n\n**Selection:** select_program\n\n**Registration:** submit_form, load_saved_children, save_child\n\n**Profile:** load_delegate_profile, save_delegate_profile, save_location\n\n**Payment:** setup_payment_method, setup_payment, check_payment_method, show_payment_authorization, authorize_payment, confirm_payment\n\n**Scheduling:** schedule_auto_registration, confirm_scheduled_registration\n\n**Audit:** view_receipts, view_audit_trail\n\n**Cancellation:** cancel_registration, confirm_cancel_registration\n\n**Flow Control:** cancel_flow, clear_context",
    "contact": {
      "email": "support@shipworx.ai"
    },
    "x-openai-isConversational": true,
    "x-rateLimit": {
      "requests": 60,
      "period": "minute"
    }
  },
  "servers": [
    {
      "url": "https://signupassist-mcp-production.up.railway.app",
      "description": "Production MCP Server"
    }
  ],
  "paths": {
    "/orchestrator/chat": {
      "post": {
        "summary": "Talk to SignupAssist",
        "description": "Send natural language messages to find and register for children's activities. Example: 'find robotics classes in Madison WI for my 8 year old'. I'll find matching programs, show you options, and help complete registration.\n\n**Activation gate:** SignupAssist should only proceed to program discovery when the user has provided **Activity + Child Age + Location (city/state)** AND there is at least one matching program in SignupAssist's cached program feed (database).\n\n**IMPORTANT:** Nothing is booked or charged until the user explicitly confirms. Always show the audit trail option after any action.",
        "operationId": "chat",
        "x-openai-isConsequential": false,
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["message", "sessionId"],
                "properties": {
                  "message": {
                    "type": "string",
                    "description": "Natural language message from the user (e.g., 'find robotics programs in Madison', 'show me swim lessons for kids')"
                  },
                  "sessionId": {
                    "type": "string",
                    "description": "Unique session ID for conversation continuity. Use the same ID across messages in a conversation."
                  },
                  "action": {
                    "type": "string",
                    "enum": [
                      "search_programs",
                      "select_program",
                      "submit_form",
                      "authorize_payment",
                      "confirm_payment",
                      "setup_payment_method",
                      "setup_payment",
                      "cancel_registration",
                      "confirm_cancel_registration",
                      "confirm_provider",
                      "deny_provider",
                      "view_receipts",
                      "view_audit_trail",
                      "schedule_auto_registration",
                      "confirm_scheduled_registration",
                      "load_saved_children",
                      "check_payment_method",
                      "save_child",
                      "load_delegate_profile",
                      "save_delegate_profile",
                      "save_location",
                      "browse_all_programs",
                      "clear_activity_filter",
                      "show_out_of_area_programs",
                      "show_payment_authorization",
                      "cancel_flow",
                      "clear_context"
                    ],
                    "description": "Optional action from a button click. Most conversations should just use 'message' with natural language - actions are automatically returned in response button payloads. Do not manually construct actions."
                  },
                  "payload": {
                    "type": "object",
                    "description": "Data payload for the action (e.g., program_ref for select_program, answers for submit_form, child data for save_child)",
                    "additionalProperties": true
                  },
                  "userTimezone": {
                    "type": "string",
                    "description": "User's IANA timezone (e.g., 'America/Chicago'). Used for displaying times correctly.",
                    "default": "America/Chicago"
                  }
                }
              },
              "examples": {
                "find_robotics_madison": {
                  "summary": "Find robotics programs in Madison",
                  "value": {
                    "message": "Find robotics classes in Madison WI",
                    "sessionId": "chatgpt-session-123"
                  }
                },
                "find_swim_lessons_with_age": {
                  "summary": "Find swim lessons for a specific age",
                  "value": {
                    "message": "Show me swim lessons for my 8 year old",
                    "sessionId": "chatgpt-session-123",
                    "userTimezone": "America/Chicago"
                  }
                },
                "find_by_org_name": {
                  "summary": "Find programs at a specific organization",
                  "value": {
                    "message": "What programs does AIM Design offer?",
                    "sessionId": "chatgpt-session-123"
                  }
                },
"select_program_action": {
  "summary": "Select a program - MUST pass payload from displayed card button",
  "description": "When user confirms a program selection, use the EXACT payload from the displayed card's button. The payload contains program_ref and program_data which are required for registration. If only one program was shown and user says 'yes', the backend will auto-select it.",
  "value": {
    "message": "yes",
    "sessionId": "chatgpt-session-123",
    "action": "select_program",
    "payload": {
      "program_ref": "robotics-sensors-9-13",
      "program_data": {
        "title": "STEM Robotics Lab – Intro to Sensors (Ages 9–13)",
        "org_ref": "aim-design",
        "price": "$40.00"
      }
    }
  }
},
                "submit_registration_form": {
                  "summary": "Submit registration form with delegate and participant info",
                  "value": {
                    "message": "",
                    "sessionId": "chatgpt-session-123",
                    "action": "submit_form",
                    "payload": {
                      "delegate": {
                        "first_name": "Jane",
                        "last_name": "Doe",
                        "email": "jane@example.com",
                        "date_of_birth": "1985-03-15",
                        "relationship": "parent"
                      },
                      "participants": [
                        {
                          "first_name": "Tommy",
                          "last_name": "Doe",
                          "date_of_birth": "2015-06-20"
                        }
                      ]
                    }
                  }
                },
                "view_audit_trail": {
                  "summary": "View the audit trail of actions",
                  "value": {
                    "message": "",
                    "sessionId": "chatgpt-session-123",
                    "action": "view_audit_trail"
                  }
                },
                "authorize_payment": {
                  "summary": "Authorize payment for registration",
                  "value": {
                    "message": "",
                    "sessionId": "chatgpt-session-123",
                    "action": "authorize_payment",
                    "payload": {
                      "mandate_id": "uuid-mandate-id"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Chat response with message and optional UI cards",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChatResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - OAuth token required for protected actions (booking, payment)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "requiresAuth": { "type": "boolean" },
                    "authUrl": { "type": "string" }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "details": { "type": "string" }
                  }
                }
              }
            }
          }
        },
        "security": [
          {},
          { "oauth2": ["openid", "profile", "email"] }
        ]
      }
    },
    "/sse": {
      "get": {
        "summary": "SSE Connection Endpoint",
        "description": "Establishes a Server-Sent Events (SSE) connection for MCP communication. ChatGPT Apps Connector uses this to receive streaming responses from the MCP server. The connection stays open and the server pushes events as they occur.",
        "operationId": "sseConnect",
        "responses": {
          "200": {
            "description": "SSE stream established",
            "content": {
              "text/event-stream": {
                "schema": {
                  "type": "string",
                  "description": "Server-Sent Events stream with MCP JSON-RPC messages"
                }
              }
            }
          }
        },
        "security": []
      }
    },
    "/messages": {
      "post": {
        "summary": "SSE Message Endpoint",
        "description": "Receives JSON-RPC messages from the client and forwards them to the MCP server through the SSE transport. Requires an active SSE session established via /sse endpoint.",
        "operationId": "sseMessage",
        "parameters": [
          {
            "name": "sessionId",
            "in": "query",
            "required": true,
            "description": "Session ID from the SSE connection",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "description": "JSON-RPC 2.0 message for MCP protocol",
                "properties": {
                  "jsonrpc": {
                    "type": "string",
                    "enum": ["2.0"]
                  },
                  "method": {
                    "type": "string",
                    "description": "MCP method name (e.g., 'tools/list', 'tools/call')"
                  },
                  "params": {
                    "type": "object",
                    "description": "Method parameters"
                  },
                  "id": {
                    "type": ["string", "number"],
                    "description": "Request ID for correlation"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Message processed successfully"
          },
          "400": {
            "description": "Missing sessionId parameter"
          },
          "404": {
            "description": "Session not found - reconnect to /sse"
          }
        },
        "security": []
      }
    },
    "/signupassist/start": {
      "get": {
        "summary": "Show available programs immediately",
        "description": "**CALL THIS FIRST.** Read-only action-first entrypoint. Immediately shows available programs without requiring any user input. Does NOT create bookings. Does NOT charge payments. Safe to call anytime. Use this as the FIRST action when user expresses any intent to find or sign up for classes.",
        "operationId": "signupassist_start",
        "x-openai-isConsequential": false,
        "parameters": [
          {
            "name": "org_ref",
            "in": "query",
            "required": false,
            "description": "Organization reference (default: aim-design)",
            "schema": {
              "type": "string",
              "default": "aim-design"
            }
          },
          {
            "name": "category",
            "in": "query",
            "required": false,
            "description": "Optional category filter",
            "schema": {
              "type": "string",
              "enum": ["all", "lessons", "camps", "events", "tours"],
              "default": "all"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of available programs with cards for display",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProviderResponse"
                }
              }
            }
          }
        },
        "security": []
      }
    },
    "/tools/call": {
      "post": {
        "summary": "Direct tool access (internal use only)",
        "description": "Execute a specific registration tool directly. **Most users should use /orchestrator/chat instead** - it's easier and handles everything automatically.",
        "operationId": "callTool",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["tool", "args"],
                "properties": {
                  "tool": {
                    "type": "string",
                    "enum": [
                      "bookeo.find_programs",
                      "bookeo.get_registration_form",
                      "bookeo.reserve_spot",
                      "bookeo.confirm_booking",
                      "bookeo.cancel_booking"
                    ],
                    "description": "Tool to execute. Use 'bookeo.find_programs' to search for classes, 'bookeo.get_registration_form' to see what info is needed, 'bookeo.reserve_spot' to hold a spot, 'bookeo.confirm_booking' to finalize."
                  },
                  "args": {
                    "type": "object",
                    "description": "Tool-specific arguments",
                    "additionalProperties": true
                  },
                  "mandate_id": {
                    "type": "string",
                    "description": "Optional mandate ID for audit trail",
                    "format": "uuid"
                  },
                  "plan_execution_id": {
                    "type": "string",
                    "description": "Optional plan execution ID for tracking",
                    "format": "uuid"
                  }
                }
              },
              "examples": {
                "bookeo_find_programs": {
                  "summary": "Find programs at a Bookeo-powered organization",
                  "value": {
                    "tool": "bookeo.find_programs",
                    "args": {
                      "org_ref": "aim-design",
                      "category": "all"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful tool execution",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProviderResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "details": { "type": "string" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - OAuth token invalid or missing",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Tool not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "available_tools": {
                      "type": "array",
                      "items": { "type": "string" }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "details": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ChatResponse": {
        "type": "object",
        "description": "Response from the chat orchestrator containing the assistant message and optional UI elements",
        "required": ["message"],
        "properties": {
          "message": {
            "type": "string",
            "description": "The assistant's response message to display to the user"
          },
          "cards": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/UICard" },
            "description": "UI cards for programs, forms, confirmations, or other structured content"
          },
          "cta": {
            "type": "object",
            "description": "Call-to-action buttons for the response",
            "properties": {
              "buttons": {
                "type": "array",
                "items": { "$ref": "#/components/schemas/Button" }
              }
            }
          },
          "actions": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/Button" },
            "description": "Available actions the user can take (legacy format, prefer cta.buttons)"
          },
          "contextUpdates": {
            "type": "object",
            "description": "State changes from this interaction (for debugging/tracking)",
            "properties": {
              "currentStep": { "type": "string" },
              "selectedProgram": { "type": "string" },
              "selectedChild": { "type": "string" },
              "provider": { "type": "string" }
            },
            "additionalProperties": true
          },
          "metadata": {
            "type": "object",
            "description": "Response metadata for tracking and UI hints",
            "properties": {
              "componentType": {
                "type": "string",
                "enum": ["payment_setup", "form", "confirmation", "audit_trail", "program_list", "profile", "schedule"],
                "description": "UI component type hint for rendering"
              },
              "next_action": {
                "type": "string",
                "description": "Suggested next action for the flow"
              },
              "mandate_id": {
                "type": "string",
                "format": "uuid",
                "description": "Mandate ID for audit trail tracking"
              },
              "audit_trail_id": {
                "type": "string",
                "description": "Audit trail entry ID for this action"
              },
              "registration_id": {
                "type": "string",
                "format": "uuid",
                "description": "Registration ID when a booking is created"
              },
              "_build": {
                "type": "object",
                "description": "Build metadata for debugging",
                "additionalProperties": true
              }
            },
            "additionalProperties": true
          },
          "suggestedQueries": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Suggested follow-up queries the user might want to ask",
            "examples": [
              ["Show me the schedule", "What ages is this for?", "How much does it cost?"]
            ]
          },
          "error": {
            "type": "object",
            "description": "Error information if the request failed",
            "properties": {
              "code": { "type": "string" },
              "message": { "type": "string" },
              "recoveryHint": { "type": "string" }
            }
          },
          "session_context": {
            "type": "object",
            "description": "Current session state (for debugging)",
            "additionalProperties": true
          }
        }
      },
      "Button": {
        "type": "object",
        "description": "Interactive button for user actions",
        "required": ["label", "action"],
        "properties": {
          "label": {
            "type": "string",
            "description": "Button text displayed to user"
          },
          "action": {
            "type": "string",
            "description": "Action identifier to send back when clicked"
          },
          "payload": {
            "type": "object",
            "description": "Data to include when this action is triggered",
            "additionalProperties": true
          },
          "variant": {
            "type": "string",
            "enum": ["accent", "outline", "destructive"],
            "default": "accent"
          },
          "requiresAuth": {
            "type": "boolean",
            "description": "Whether this action requires OAuth authentication",
            "default": false
          }
        }
      },
      "ToolMetadata": {
        "type": "object",
        "description": "Metadata hints for AI tone and UX guidance",
        "properties": {
          "tone_hints": {
            "type": "string",
            "description": "Guidance for AI tone (e.g., 'Emphasize age ranges and schedule flexibility')"
          },
          "security_note": {
            "type": "string",
            "description": "Security reminder to display"
          },
          "next_actions": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Suggested next actions for the user"
          },
          "confidence": {
            "type": "string",
            "enum": ["high", "medium", "low"],
            "description": "Confidence level of the response"
          }
        }
      },
      "UICard": {
        "type": "object",
        "description": "UI card specification for consistent rendering of programs, forms, and confirmations",
        "required": ["title"],
        "properties": {
          "type": {
            "type": "string",
            "enum": ["program", "form", "confirmation", "error", "info", "audit_trail", "payment", "schedule"],
            "description": "Card type for rendering hints"
          },
          "title": { "type": "string" },
          "subtitle": { "type": "string" },
          "description": { "type": "string" },
          "imageUrl": { "type": "string", "format": "uri" },
          "metadata": {
            "type": "object",
            "description": "Structured data (price, dates, age range, etc.)",
            "properties": {
              "price": { "type": "string" },
              "ageRange": { "type": "string" },
              "dates": { "type": "string" },
              "location": { "type": "string" },
              "spotsAvailable": { "type": "integer" },
              "mandate_id": { "type": "string" },
              "registration_id": { "type": "string" }
            },
            "additionalProperties": true
          },
          "buttons": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/Button" }
          }
        }
      },
      "ParentFriendlyError": {
        "type": "object",
        "description": "Parent-friendly error structure",
        "required": ["display", "recovery", "severity"],
        "properties": {
          "display": {
            "type": "string",
            "description": "What parent sees"
          },
          "recovery": {
            "type": "string",
            "description": "Clear next step"
          },
          "severity": {
            "type": "string",
            "enum": ["low", "medium", "high"]
          },
          "code": {
            "type": "string",
            "description": "Internal error code"
          }
        }
      },
      "ProviderResponse": {
        "type": "object",
        "description": "Standard response format for all provider tools",
        "required": ["success"],
        "properties": {
          "success": { "type": "boolean" },
          "data": {
            "type": "object",
            "additionalProperties": true
          },
          "meta": { "$ref": "#/components/schemas/ToolMetadata" },
          "ui": {
            "type": "object",
            "properties": {
              "cards": {
                "type": "array",
                "items": { "$ref": "#/components/schemas/UICard" }
              },
              "message": { "type": "string" }
            }
          },
          "error": {
            "oneOf": [
              { "$ref": "#/components/schemas/ParentFriendlyError" },
              { "type": "string" }
            ]
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "bookeo.find_programs_input": {
        "type": "object",
        "description": "Search for available classes and programs at an organization",
        "properties": {
          "org_ref": {
            "type": "string",
            "description": "Organization ID (e.g., 'aim-design' for AIM Design in Madison)"
          },
          "category": {
            "type": "string",
            "description": "Activity type filter: 'stem', 'robotics', 'art', 'all'"
          }
        },
        "required": ["org_ref"],
        "additionalProperties": false
      },
      "bookeo.get_registration_form_input": {
        "type": "object",
        "description": "Get the registration form fields needed to sign up for a class",
        "properties": {
          "program_ref": {
            "type": "string",
            "description": "Program ID from find_programs results"
          },
          "org_ref": {
            "type": "string",
            "description": "Organization ID"
          }
        },
        "required": ["program_ref", "org_ref"],
        "additionalProperties": false
      },
      "bookeo.reserve_spot_input": {
        "type": "object",
        "description": "Temporarily reserve a spot in a class while completing registration",
        "properties": {
          "eventId": {
            "type": "string",
            "description": "Class session ID"
          },
          "productId": {
            "type": "string",
            "description": "Program ID"
          },
          "firstName": {
            "type": "string",
            "description": "Parent's first name"
          },
          "lastName": {
            "type": "string",
            "description": "Parent's last name"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Parent's email"
          },
          "phone": {
            "type": "string",
            "description": "Parent's phone (optional)"
          },
          "adults": {
            "type": "integer",
            "description": "Number of adults attending"
          },
          "children": {
            "type": "integer",
            "description": "Number of children to register"
          },
          "org_ref": {
            "type": "string",
            "description": "Organization ID"
          }
        },
        "required": ["eventId", "productId", "firstName", "lastName", "email", "adults", "children", "org_ref"],
        "additionalProperties": false
      },
      "bookeo.confirm_booking_input": {
        "type": "object",
        "description": "Complete the registration and confirm the booking",
        "properties": {
          "holdId": {
            "type": "string",
            "description": "Reservation ID from reserve_spot"
          },
          "org_ref": {
            "type": "string",
            "description": "Organization ID"
          }
        },
        "required": ["holdId", "org_ref"],
        "additionalProperties": false
      },
      "bookeo.cancel_booking_input": {
        "type": "object",
        "description": "Cancel an existing registration",
        "properties": {
          "bookingNumber": {
            "type": "string",
            "description": "Confirmation number to cancel"
          },
          "org_ref": {
            "type": "string",
            "description": "Organization ID"
          }
        },
        "required": ["bookingNumber", "org_ref"],
        "additionalProperties": false
      }
    },
    "securitySchemes": {
      "oauth2": {
        "type": "oauth2",
        "description": "OAuth 2.0 authentication for protected actions (booking confirmations, payments). Public queries (finding programs) do not require authentication.",
        "flows": {
          "authorizationCode": {
            "authorizationUrl": "https://signupassist-mcp-production.up.railway.app/oauth/authorize",
            "tokenUrl": "https://signupassist-mcp-production.up.railway.app/oauth/token",
            "scopes": {
              "openid": "OpenID Connect",
              "profile": "User profile",
              "email": "User email"
            }
          }
        }
      }
    }
  },
  "security": [
    { "oauth2": ["openid", "profile", "email"] }
  ]
}
