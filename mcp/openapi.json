{
  "openapi": "3.1.0",
  "info": {
    "title": "SignupAssist MCP API",
    "version": "2.0.0",
    "description": "API-first activity registration system. Supports program discovery, registration form discovery, booking, and payment via direct API integrations (Bookeo, and more coming soon).",
    "contact": {
      "email": "matt@shipworx.ai"
    }
  },
  "servers": [
    {
      "url": "https://signupassist-mcp-production.up.railway.app",
      "description": "Production MCP Server"
    }
  ],
  "paths": {
    "/tools/call": {
      "post": {
        "summary": "Execute MCP tool",
        "description": "Execute any registered MCP tool by name with provided arguments. All tools go through MCP audit layer for compliance.",
        "operationId": "callTool",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["tool", "args"],
                "properties": {
                  "tool": {
                    "type": "string",
                    "enum": [
                      "bookeo.find_programs",
                      "bookeo.discover_required_fields",
                      "bookeo.create_hold",
                      "bookeo.confirm_booking",
                      "bookeo.cancel_booking",
                      "program_feed.get"
                    ],
                    "description": "Name of the tool to execute"
                  },
                  "args": {
                    "type": "object",
                    "description": "Tool-specific arguments",
                    "additionalProperties": true
                  },
                  "mandate_id": {
                    "type": "string",
                    "description": "Optional mandate ID for audit trail",
                    "format": "uuid"
                  },
                  "plan_execution_id": {
                    "type": "string",
                    "description": "Optional plan execution ID for tracking",
                    "format": "uuid"
                  }
                }
              },
              "examples": {
                "bookeo_find_programs": {
                  "summary": "Find programs at a Bookeo-powered organization",
                  "value": {
                    "tool": "bookeo.find_programs",
                    "args": {
                      "org_ref": "aim-design",
                      "category": "all"
                    }
                  }
                },
                "bookeo_find_programs_robotics": {
                  "summary": "Find robotics programs in Madison",
                  "value": {
                    "tool": "bookeo.find_programs",
                    "args": {
                      "org_ref": "aim-design",
                      "category": "stem"
                    }
                  }
                },
                "bookeo_discover_required_fields": {
                  "summary": "Discover registration form fields for a program",
                  "value": {
                    "tool": "bookeo.discover_required_fields",
                    "args": {
                      "program_ref": "41567PWU9J419AAC02D5B2",
                      "org_ref": "aim-design"
                    }
                  }
                },
                "bookeo_create_hold": {
                  "summary": "Create a temporary booking hold",
                  "value": {
                    "tool": "bookeo.create_hold",
                    "args": {
                      "eventId": "event-123",
                      "productId": "product-456",
                      "firstName": "Jane",
                      "lastName": "Doe",
                      "email": "jane@example.com",
                      "adults": 0,
                      "children": 1,
                      "org_ref": "aim-design"
                    }
                  }
                },
                "bookeo_confirm_booking": {
                  "summary": "Confirm a booking hold",
                  "value": {
                    "tool": "bookeo.confirm_booking",
                    "args": {
                      "holdId": "hold-789",
                      "org_ref": "aim-design"
                    }
                  }
                },
                "program_feed_get": {
                  "summary": "Get cached programs (fast lookup)",
                  "value": {
                    "tool": "program_feed.get",
                    "args": {
                      "org_ref": "aim-design",
                      "category": "all"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful tool execution",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProviderResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "details": { "type": "string" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - OAuth token invalid or missing",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Tool not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "available_tools": {
                      "type": "array",
                      "items": { "type": "string" }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "details": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ToolMetadata": {
        "type": "object",
        "description": "Metadata hints for AI tone and UX guidance",
        "properties": {
          "tone_hints": {
            "type": "string",
            "description": "Guidance for AI tone (e.g., 'Emphasize age ranges and schedule flexibility')"
          },
          "security_note": {
            "type": "string",
            "description": "Security reminder to display"
          },
          "next_actions": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Suggested next actions for the user"
          },
          "confidence": {
            "type": "string",
            "enum": ["high", "medium", "low"],
            "description": "Confidence level of the response"
          }
        }
      },
      "UICard": {
        "type": "object",
        "description": "UI card specification for consistent rendering",
        "required": ["title"],
        "properties": {
          "title": { "type": "string" },
          "subtitle": { "type": "string" },
          "description": { "type": "string" },
          "metadata": {
            "type": "object",
            "additionalProperties": true
          },
          "buttons": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["label", "action"],
              "properties": {
                "label": { "type": "string" },
                "action": { "type": "string" },
                "variant": {
                  "type": "string",
                  "enum": ["accent", "outline"]
                }
              }
            }
          }
        }
      },
      "ParentFriendlyError": {
        "type": "object",
        "description": "Parent-friendly error structure",
        "required": ["display", "recovery", "severity"],
        "properties": {
          "display": {
            "type": "string",
            "description": "What parent sees"
          },
          "recovery": {
            "type": "string",
            "description": "Clear next step"
          },
          "severity": {
            "type": "string",
            "enum": ["low", "medium", "high"]
          },
          "code": {
            "type": "string",
            "description": "Internal error code"
          }
        }
      },
      "ProviderResponse": {
        "type": "object",
        "description": "Standard response format for all provider tools",
        "required": ["success"],
        "properties": {
          "success": { "type": "boolean" },
          "data": {
            "type": "object",
            "additionalProperties": true
          },
          "meta": { "$ref": "#/components/schemas/ToolMetadata" },
          "ui": {
            "type": "object",
            "properties": {
              "cards": {
                "type": "array",
                "items": { "$ref": "#/components/schemas/UICard" }
              },
              "message": { "type": "string" }
            }
          },
          "error": {
            "oneOf": [
              { "$ref": "#/components/schemas/ParentFriendlyError" },
              { "type": "string" }
            ]
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "bookeo.find_programs_input": {
        "type": "object",
        "properties": {
          "org_ref": {
            "type": "string",
            "description": "Organization reference (e.g., 'aim-design' for Madison robotics/STEM)"
          },
          "category": {
            "type": "string",
            "description": "Optional category filter (e.g., 'stem', 'all')"
          }
        },
        "required": ["org_ref"],
        "additionalProperties": false
      },
      "bookeo.discover_required_fields_input": {
        "type": "object",
        "properties": {
          "program_ref": {
            "type": "string",
            "description": "Program reference ID from find_programs"
          },
          "org_ref": {
            "type": "string",
            "description": "Organization reference"
          }
        },
        "required": ["program_ref", "org_ref"],
        "additionalProperties": false
      },
      "bookeo.create_hold_input": {
        "type": "object",
        "properties": {
          "eventId": {
            "type": "string",
            "description": "Bookeo event ID"
          },
          "productId": {
            "type": "string",
            "description": "Bookeo product ID"
          },
          "firstName": {
            "type": "string",
            "description": "Customer first name"
          },
          "lastName": {
            "type": "string",
            "description": "Customer last name"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Customer email"
          },
          "phone": {
            "type": "string",
            "description": "Customer phone (optional)"
          },
          "adults": {
            "type": "integer",
            "description": "Number of adult participants"
          },
          "children": {
            "type": "integer",
            "description": "Number of child participants"
          },
          "org_ref": {
            "type": "string",
            "description": "Organization reference"
          }
        },
        "required": ["eventId", "productId", "firstName", "lastName", "email", "adults", "children", "org_ref"],
        "additionalProperties": false
      },
      "bookeo.confirm_booking_input": {
        "type": "object",
        "properties": {
          "holdId": {
            "type": "string",
            "description": "Hold ID from create_hold"
          },
          "org_ref": {
            "type": "string",
            "description": "Organization reference"
          }
        },
        "required": ["holdId", "org_ref"],
        "additionalProperties": false
      },
      "bookeo.cancel_booking_input": {
        "type": "object",
        "properties": {
          "bookingNumber": {
            "type": "string",
            "description": "Booking number to cancel"
          },
          "org_ref": {
            "type": "string",
            "description": "Organization reference"
          }
        },
        "required": ["bookingNumber", "org_ref"],
        "additionalProperties": false
      },
      "program_feed.get_input": {
        "type": "object",
        "properties": {
          "org_ref": {
            "type": "string",
            "description": "Organization reference"
          },
          "category": {
            "type": "string",
            "description": "Category filter"
          },
          "age_hint": {
            "type": "integer",
            "description": "Optional age for filtering age-appropriate programs"
          }
        },
        "required": ["org_ref"],
        "additionalProperties": false
      }
    },
    "securitySchemes": {
      "oauth2": {
        "type": "oauth2",
        "flows": {
          "authorizationCode": {
            "authorizationUrl": "https://dev-xha4aa58ytpvlqyl.us.auth0.com/authorize",
            "tokenUrl": "https://dev-xha4aa58ytpvlqyl.us.auth0.com/oauth/token",
            "scopes": {
              "openid": "OpenID Connect",
              "profile": "User profile",
              "email": "User email"
            }
          }
        }
      }
    }
  },
  "security": [
    { "oauth2": ["openid", "profile", "email"] }
  ]
}
